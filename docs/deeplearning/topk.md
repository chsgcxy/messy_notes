# TopK ç®—æ³•

TopKæ˜¯æŒ‡ä»arr[n]ä¸­æ‰¾å‡ºæœ€å¤§çš„Kä¸ªæ•°

## ç®—æ³•ä¸€ æ’åº

å°†Nä¸ªæ•°æ’åºä¹‹åï¼Œå–å‡ºæœ€å¤§çš„Kä¸ªæ•°ã€‚å‡è®¾10ä¸ªæ•°çš„æ•°ç»„ï¼Œä»ä¸­æ‰¾å‡ºtop3,å¯ä»¥æœ‰å¦‚ä¸‹åšæ³•

```
import random
arr=[random.randint(1,20) for x in range(10)]
arr.sort()
arr[-3:]
```

æ—¶é—´å¤æ‚åº¦O(n * lg(n)),æ˜æ˜åªéœ€è¦topK,ä½†å¯¹å…¨å±€éƒ½è¿›è¡Œäº†æ’åºï¼Œå› æ­¤è¿™ä¸ªæ–¹æ³•çš„å¤æ‚åº¦å¾ˆé«˜ã€‚é€šè¿‡å±€éƒ¨çš„æ’åºï¼Œä»…å¯¹Kä¸ªå…ƒç´ è¿›è¡Œæ’åºï¼Œå¯ä»¥ç¼©å°å¤æ‚åº¦ï¼Œä½¿å¤æ‚åº¦å˜æˆO(n * k)

## ç®—æ³•äºŒ å †

å †(heap)æ˜¯ä¸€ç§æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„å®Œå…¨äºŒå‰æ ‘ï¼Œä¸»è¦å¯åˆ†ä¸ºä¸¤ç§ç±»å‹

- å¤§é¡¶å †(max heap): ä»»æ„èŠ‚ç‚¹çš„å€¼ â‰¥ å…¶å­èŠ‚ç‚¹çš„å€¼
- å°é¡¶å †(min heap)ï¼šä»»æ„èŠ‚ç‚¹çš„å€¼ â‰¤ å…¶å­èŠ‚ç‚¹çš„å€¼

å †ä½œä¸ºå®Œå…¨äºŒå‰æ ‘çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§:

- æœ€åº•å±‚èŠ‚ç‚¹é å·¦å¡«å……ï¼Œå…¶ä»–å±‚çš„èŠ‚ç‚¹éƒ½è¢«å¡«æ»¡ã€‚
- æˆ‘ä»¬å°†äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ç§°ä¸ºâ€œå †é¡¶â€ï¼Œå°†åº•å±‚æœ€é å³çš„èŠ‚ç‚¹ç§°ä¸ºâ€œå †åº•â€ã€‚
- å¯¹äºå¤§é¡¶å †ï¼ˆå°é¡¶å †ï¼‰ï¼Œå †é¡¶å…ƒç´ ï¼ˆå³æ ¹èŠ‚ç‚¹ï¼‰çš„å€¼åˆ†åˆ«æ˜¯æœ€å¤§ï¼ˆæœ€å°ï¼‰çš„ã€‚

å †æ˜¯ä¸€ç§å®Œå…¨äºŒå‰æ ‘ï¼Œå®Œå…¨äºŒå‰æ ‘éå¸¸é€‚åˆç”¨æ•°ç»„æ¥è¡¨ç¤ºã€‚å½“ä½¿ç”¨æ•°ç»„æ¥è¡¨ç¤ºå®Œå…¨äºŒå‰æ ‘æ—¶ï¼Œå…ƒç´ ä»£è¡¨èŠ‚ç‚¹å€¼ï¼Œç´¢å¼•ä»£è¡¨èŠ‚ç‚¹åœ¨äºŒå‰æ ‘ä¸­çš„ä½ç½®ã€‚ç»™å®šç´¢å¼• ğ‘– ï¼Œå…¶å·¦å­èŠ‚ç‚¹ç´¢å¼•ä¸º 2ğ‘– + 1 ï¼Œå³å­èŠ‚ç‚¹ç´¢å¼•ä¸º 2ğ‘– + 2 ï¼Œçˆ¶èŠ‚ç‚¹ç´¢å¼•ä¸º (ğ‘– âˆ’ 1)/2
ï¼ˆå‘ä¸‹å–æ•´ï¼‰ã€‚å½“ç´¢å¼•è¶Šç•Œæ—¶ï¼Œè¡¨ç¤ºç©ºèŠ‚ç‚¹æˆ–èŠ‚ç‚¹ä¸å­˜åœ¨ã€‚

éœ€æ±‚æ˜¯æ‰¾åˆ°TopK, è¿™Kä¸ªå…ƒç´ å®é™…ä¸Šæ˜¯ä¸éœ€è¦æ’åºçš„ï¼Œå› æ­¤é‡‡å–è¿™Kä¸ªå€¼ä¸æ’åºçš„æ–¹æ³•èƒ½å¤Ÿè¿›ä¸€æ­¥é™ä½å¤æ‚åº¦ã€‚ç”¨arrçš„å‰Kä¸ªå…ƒç´ ç”Ÿæˆä¸€ä¸ªå°é¡¶å †ï¼Œç”¨æ¥å­˜å‚¨å½“å‰æœ€å¤§çš„Kä¸ªå…ƒç´ ã€‚å †çš„å¤§å°æ˜¯ä¸å˜çš„ï¼Œåªéœ€è¦å¯¹å †é¡¶å…ƒç´ è¿›è¡Œæ›¿æ¢æ“ä½œï¼Œç„¶åä»é¡¶è‡³åº•è¿›è¡Œå †åŒ–ã€‚ä»arrçš„ç¬¬K+1ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œéå†arrä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœå…ƒç´ å¤§äºå †é¡¶ï¼Œå°±æ›¿æ¢å †é¡¶å…ƒç´ ï¼Œè°ƒæ•´å †ï¼Œä»¥ä¿è¯å †å†…çš„Kä¸ªå…ƒç´ ï¼Œæ€»æ˜¯å½“å‰æœ€å¤§çš„Kä¸ªå…ƒç´ ã€‚

```c++

#define HEAP_LEFT(i)   (2 * i + 1)
#define HEAP_RIGHT(i)  (2 * i + 2)
#define HEAP_PARENT(i) ((i-1) >> 1)

template <typename T>
void heapify(T arr[], int len, int start)
{
    int child = HEAP_LEFT(start);
    int right = HEAP_RIGHT(start);
    while (child < len) {
        if (right < len && arr[right] < arr[child]) {
            child = right;
        }

        if (arr[child] < arr[start]) {
            swap<T>(&arr[child], &arr[idx]);
            start = child;
            child = HEAP_LEFT(start);
        } else {
            break;
        }
    }
}

template<typename T>
void topK(T arr[], int k, int n)
{
    T heap[k];
    memcpy(heap, arr, sizeof(T) * k);
    for (int i = k / 2 - 1; i >= 0; --i) {
        heapify<T>(heap, k, i);
    }
    for (int i = k; i < n; ++i) {
        if (heap[0] < arr[i]) {
            heap[0] = arr[i];
            heapify<T>(heap, k, 0);
        }
    }
}    
    
```

## ç®—æ³•ä¸‰ åˆ†æ²»æ³•

ä¸å¿«é€Ÿæ’åºç›¸ç±»ä¼¼, TopKæ˜¯å¸Œæœ›æ±‚å‡ºarr[n]ä¸­æœ€å¤§çš„kä¸ªæ•°, å¦‚æœæ‰¾åˆ°äº†ç¬¬kå¤§çš„æ•°, åšä¸€æ¬¡partition, å°±èƒ½æ‰¾åˆ°æ²¡æœ‰æ’åºçš„æœ€å¤§çš„Kä¸ªæ•°ã€‚

ä¸æ’åºä¸åŒçš„æ˜¯, è¿™é‡ŒæŒ‰ç…§å¤§åˆ°å°æ’åº, åšå®Œä¸€æ¬¡partition:

- å¦‚æœiå¤§äºk, åˆ™è¯´æ˜arr[i]å·¦è¾¹çš„å…ƒç´ éƒ½å¤§äºk, äºæ˜¯åªé€’å½’arr[1, i-1]é‡Œç¬¬kå¤§çš„å…ƒç´ å³å¯
- å¦‚æœiå°äºk, åˆ™è¯´æ˜è¯´æ˜ç¬¬kå¤§çš„å…ƒç´ åœ¨arr[i]çš„å³è¾¹, äºæ˜¯åªé€’å½’arr[i+1, n]é‡Œç¬¬k-iå¤§çš„å…ƒç´ å³å¯

è¿™æ ·å°±èƒ½æ‰¾åˆ°ç¬¬Kå¤§çš„å…ƒç´ , ç„¶åå†åšä¸€æ¬¡partition, å°±èƒ½æ‰¾åˆ°æœ€å¤§çš„Kä¸ªå…ƒç´ ã€‚

## åè®°

æ–‡ä¸­æ¶‰åŠçš„ç®—æ³•å‡å¯åœ¨ [github.com/krahets/helloâ€‘algo](github.com/krahets/helloâ€‘algo) ä¸­æ‰¾åˆ°è¯¦ç»†è§£é‡Š
