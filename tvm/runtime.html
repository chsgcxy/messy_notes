<!DOCTYPE html><html><head>
      <title>runtime</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////home/hao.chen/.vscode/extensions/shd101wyy.markdown-preview-enhanced-0.4.3/node_modules/@shd101wyy/mume/dependencies/katex/katex.min.css">
      
      

      
      
      
      
      
      

      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h1 class="mume-header" id="runtime">runtime</h1>

<p>runtime&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x4E3B;&#x8981;&#x5E72;&#x4E86;&#x4E09;&#x4EF6;&#x4E8B;&#x60C5;</p>
<ul>
<li>&#x521D;&#x59CB;&#x5316;&#x8FC7;&#x7A0B;&#xFF0C;&#x89E3;&#x6790;graph&#xFF0C;&#x8F6C;&#x6362;&#x4E3A;&#x5185;&#x90E8;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x8C03;&#x7528;DeviceAPI&#xFF0C;&#x5728;device&#x4E0A;&#x5206;&#x914D;&#x5185;&#x5B58;&#x7A7A;&#x95F4;</li>
<li>&#x53C2;&#x6570;&#x8BBE;&#x7F6E;&#x8FC7;&#x7A0B;&#xFF0C;&#x5C06;&#x53C2;&#x6570;copy&#x5230;&#x5206;&#x914D;&#x597D;&#x7684;device&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x4E0A;</li>
<li>&#x8FD0;&#x884C;&#x8FC7;&#x7A0B;&#xFF0C;&#x904D;&#x5386;&#x6267;&#x884C;&#x89E3;&#x6790;&#x5B8C;&#x7684;graph&#x4E2D;&#x7684;function</li>
</ul>
<h2 class="mume-header" id="runtime-flow">runtime-flow</h2>

<p>example tvm:build with target cuda and target host llvm</p>
<p><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" contentscripttype="application/ecmascript" contentstyletype="text/css" height="591px" preserveAspectRatio="none" style="width:829px;height:591px;" version="1.1" viewBox="0 0 829 591" width="829px" zoomAndPan="magnify"><defs><filter height="300%" id="f1sxy65uoqrtm3" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--cluster device code--><rect fill="#FFFFFF" filter="url(#f1sxy65uoqrtm3)" height="102" style="stroke: #000000; stroke-width: 1.5;" width="324" x="494.5" y="350"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="96" x="608.5" y="364.9951">device code</text><!--cluster host code--><rect fill="#FFFFFF" filter="url(#f1sxy65uoqrtm3)" height="378" style="stroke: #000000; stroke-width: 1.5;" width="408" x="78.5" y="202"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="79" x="243" y="216.9951">host code</text><ellipse cx="656.5781" cy="410.3156" fill="#FEFECE" filter="url(#f1sxy65uoqrtm3)" rx="154.5781" ry="33.3156" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="292" x="510.5781" y="414.9641">CUDAModuleNode : runtime::ModuleNode</text><ellipse cx="326.6716" cy="261.8343" fill="#FEFECE" filter="url(#f1sxy65uoqrtm3)" rx="152.1716" ry="32.8343" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="287" x="183.1716" y="266.4828">LLVMModuleNode : runtime::ModuleNode</text><ellipse cx="201.6274" cy="546.5255" fill="#FEFECE" filter="url(#f1sxy65uoqrtm3)" rx="115.6274" ry="25.5255" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="210" x="96.6274" y="551.1739">TVMBackendGetFuncFromEnv</text><ellipse cx="415.466" cy="546.4932" fill="#FEFECE" filter="url(#f1sxy65uoqrtm3)" rx="62.966" ry="14.9932" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="371.466" y="551.1416">TVMFuncCall</text><ellipse cx="326.2932" cy="44.4586" fill="#FEFECE" filter="url(#f1sxy65uoqrtm3)" rx="85.2932" ry="19.4586" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="254.7932" y="49.1071">split_dev_host_funcs</text><ellipse cx="613.6482" cy="44.5236" fill="#FEFECE" filter="url(#f1sxy65uoqrtm3)" rx="37.6482" ry="14.5236" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="589.1482" y="49.1721">fdevice</text><ellipse cx="474.7487" cy="44.5236" fill="#FEFECE" filter="url(#f1sxy65uoqrtm3)" rx="27.7487" ry="14.5236" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="457.2487" y="49.1721">fhost</text><ellipse cx="73.4975" cy="44.3995" fill="#FEFECE" filter="url(#f1sxy65uoqrtm3)" rx="67.4975" ry="15.8995" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="23.4975" y="49.0479">lowered_funcs</text><ellipse cx="633.4934" cy="144.1987" fill="#FEFECE" filter="url(#f1sxy65uoqrtm3)" rx="83.9934" ry="19.1987" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="140" x="563.4934" y="148.8471">codegen.build_cuda</text><ellipse cx="405.5624" cy="144.0125" fill="#FEFECE" filter="url(#f1sxy65uoqrtm3)" rx="80.5624" ry="18.5125" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="132" x="339.5624" y="148.6609">codegen.build_llvm</text><!--link split_dev_host_funcs to fdevice--><path d="M369.5887,27.5923 C405.0025,15.7349 456.5595,3.1306 502,10 C529.9401,14.2238 560.5266,24.0834 582.5854,32.1854 " fill="none" id="split_dev_host_funcs-fdevice" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="587.4392,33.9903,580.3979,27.1041,582.7528,32.2475,577.6094,34.6024,587.4392,33.9903" style="stroke: #A80036; stroke-width: 1.0;"/><!--link split_dev_host_funcs to fhost--><path d="M412.0625,44.5 C421.8933,44.5 431.7241,44.5 441.5549,44.5 " fill="none" id="split_dev_host_funcs-fhost" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="446.6958,44.5,437.6958,40.5,441.6958,44.5,437.6958,48.5,446.6958,44.5" style="stroke: #A80036; stroke-width: 1.0;"/><!--link lowered_funcs to split_dev_host_funcs--><path d="M141.2994,44.5 C170.2178,44.5 204.3951,44.5 235.4667,44.5 " fill="none" id="lowered_funcs-split_dev_host_funcs" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="240.8264,44.5,231.8264,40.5,235.8264,44.5,231.8264,48.5,240.8264,44.5" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63" x="159.5" y="37.5669">tvm::build</text><!--link fdevice to codegen.build_cuda--><path d="M616.4511,59.1816 C619.6492,75.0923 624.8044,100.7396 628.6098,119.6712 " fill="none" id="fdevice-codegen.build_cuda" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="629.6445,124.8191,631.7922,115.2073,628.6591,119.9172,623.9492,116.784,629.6445,124.8191" style="stroke: #A80036; stroke-width: 1.0;"/><!--link codegen.build_cuda to CUDAModuleNode--><path d="M635.1541,163.166 C638.9135,206.7261 648.1604,313.8693 653.1607,371.8079 " fill="none" id="codegen.build_cuda-CUDAModuleNode" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="653.6016,376.9163,656.8128,367.6056,653.1716,371.9348,648.8424,368.2936,653.6016,376.9163" style="stroke: #A80036; stroke-width: 1.0;"/><!--link fhost to codegen.build_llvm--><path d="M464.9058,58.335 C453.614,74.6182 434.7004,101.8922 421.2491,121.2894 " fill="none" id="fhost-codegen.build_llvm" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="418.2965,125.5471,426.7121,120.4307,421.1457,121.4383,420.1381,115.8719,418.2965,125.5471" style="stroke: #A80036; stroke-width: 1.0;"/><!--link codegen.build_llvm to LLVMModuleNode--><path d="M393.1563,162.4375 C382.0554,179.0186 365.4082,203.8839 351.5279,224.6166 " fill="none" id="codegen.build_llvm-LLVMModuleNode" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="348.611,228.9735,356.9418,223.7202,351.3927,224.8187,350.2942,219.2695,348.611,228.9735" style="stroke: #A80036; stroke-width: 1.0;"/><!--link LLVMModuleNode to TVMBackendGetFuncFromEnv--><path d="M312.0388,294.9137 C287.5848,350.5709 238.4242,462.4606 214.7874,516.2578 " fill="none" id="LLVMModuleNode-TVMBackendGetFuncFromEnv" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="212.7184,520.9669,220.001,514.3364,214.7298,516.3893,212.6769,511.1181,212.7184,520.9669" style="stroke: #A80036; stroke-width: 1.0;"/><!--link TVMBackendGetFuncFromEnv to TVMFuncCall--><path d="M317.2773,546.5 C327.1881,546.5 337.0989,546.5 347.0097,546.5 " fill="none" id="TVMBackendGetFuncFromEnv-TVMFuncCall" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="352.1924,546.5,343.1924,542.5,347.1924,546.5,343.1924,550.5,352.1924,546.5" style="stroke: #A80036; stroke-width: 1.0;"/><!--link LLVMModuleNode to CUDAModuleNode--><path d="M321.0134,300.2677 C321.0846,315.3337 324.3382,331.507 335.5,342 C348.3882,354.1159 477.1772,346.4191 494.5,350 C526.6938,356.655 560.9858,368.6857 589.6909,380.2758 " fill="none" id="LLVMModuleNode-CUDAModuleNode" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="321.1045,295.2107,316.9429,304.1371,321.0144,300.2099,324.9416,304.2814,321.1045,295.2107" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="336.5" y="338.0669">LLVMModuleNode.Import(CUDAModuleNode)</text><!--link CUDAModuleNode to TVMBackendGetFuncFromEnv--><path d="M555.4045,438.0424 C535.3084,443.0517 514.2999,447.9618 494.5,452 C431.0633,464.938 412.3082,454.7295 350.5,474 C312.1879,485.9449 271.386,506.3999 242.1841,522.5434 " fill="none" id="CUDAModuleNode-TVMBackendGetFuncFromEnv" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="560.4928,436.7672,550.7904,435.0752,555.6428,437.9828,552.7353,442.8352,560.4928,436.7672" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="351.5" y="487.0669">CUDAModuleNode.GetFunction</text><!--link TVMFuncCall to CUDAModuleNode--><path d="M455.8956,534.8326 C485.6769,525.3196 526.5641,510.3105 559.5,491 C580.5614,478.6516 601.6877,461.7778 618.8225,446.6679 " fill="none" id="TVMFuncCall-CUDAModuleNode" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="622.64,443.2726,613.2567,446.265,618.9039,446.5955,618.5734,452.2427,622.64,443.2726" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="583.5" y="487.0669">PackedFunc(CUDAWrappedFunc)</text><!--
@startuml
(split_dev_host_funcs) -> (fdevice)
(split_dev_host_funcs) -> (fhost)
(lowered_funcs) -> (split_dev_host_funcs) : tvm::build

(fdevice) - -> (codegen.build_cuda)
rectangle "device code" {
    (CUDAModuleNode : runtime::ModuleNode) as CUDAModuleNode
    (codegen.build_cuda) - -> CUDAModuleNode
}

(fhost) - -> (codegen.build_llvm)
rectangle "host code" {
    (LLVMModuleNode : runtime::ModuleNode) as LLVMModuleNode
    (codegen.build_llvm) - -> LLVMModuleNode
    LLVMModuleNode - -> (TVMBackendGetFuncFromEnv)
    (TVMBackendGetFuncFromEnv) -> (TVMFuncCall)
}

CUDAModuleNode .left.> LLVMModuleNode: LLVMModuleNode.Import(CUDAModuleNode)
(TVMBackendGetFuncFromEnv) .up.> CUDAModuleNode: CUDAModuleNode.GetFunction
(TVMFuncCall) .> CUDAModuleNode: PackedFunc(CUDAWrappedFunc)
@enduml

PlantUML version 1.2019.07(Tue Jun 25 03:59:20 CST 2019)
(MIT source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 12.0.1+12
Operating System: Linux
OS Version: 4.15.0-54-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg></p><p>runtime work flow</p>
<p><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" contentscripttype="application/ecmascript" contentstyletype="text/css" height="2006px" preserveAspectRatio="none" style="width:2155px;height:2006px;" version="1.1" viewBox="0 0 2155 2006" width="2155px" zoomAndPan="magnify"><defs><filter height="300%" id="f1u4fyzgco69ug" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--cluster greaph_runtime.creat--><rect fill="#FFFFFF" filter="url(#f1u4fyzgco69ug)" height="960" style="stroke: #000000; stroke-width: 1.5;" width="1499" x="645" y="470"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="1309.5" y="484.9951">greaph_runtime.creat</text><!--cluster tvm build result--><rect fill="#FFFFFF" filter="url(#f1u4fyzgco69ug)" height="423" style="stroke: #000000; stroke-width: 1.5;" width="1322" x="14" y="16"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="123" x="613.5" y="30.9951">tvm build result</text><ellipse cx="1196.0384" cy="541.5077" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="210.5384" ry="44.5077" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="407" x="992.5384" y="546.1561">&#x6839;&#x636E;python&#x4F20;&#x5165;&#x7684;ctx, &#x6784;&#x5EFA;c++&#x5185;&#x90E8;&#x5B9A;&#x4E49;&#x7684;TVMContext vector</text><path d="M673.5,521.5 L673.5,561.7656 A0,0 0 0 0 673.5,561.7656 L950.5,561.7656 A0,0 0 0 0 950.5,561.7656 L950.5,545.5 L985.2383,541.5 L950.5,537.5 L950.5,531.5 L940.5,521.5 L673.5,521.5 A0,0 0 0 0 673.5,521.5 " fill="#FBFB77" filter="url(#f1u4fyzgco69ug)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M940.5,521.5 L940.5,531.5 L950.5,531.5 L940.5,521.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="679.5" y="538.5669">&#x4ECE;python/tvm/contrib/graph_runtime.py</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="679.5" y="553.6997">&#x8FDB;&#x5165;src/runtime/graph/graph_runtime.cc</text><ellipse cx="1572.1751" cy="541.535" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="130.6751" ry="28.535" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="242" x="1451.1751" y="546.1835">&#x5B9E;&#x4F8B;&#x5316;&#x7B2C;&#x4E09;&#x65B9;&#x8F6F;&#x4EF6;dmlc&#x7684;JSONReader</text><path d="M1737.5,506 L1737.5,537.5 L1702.6982,541.5 L1737.5,545.5 L1737.5,576.5313 A0,0 0 0 0 1737.5,576.5313 L2116.5,576.5313 A0,0 0 0 0 2116.5,576.5313 L2116.5,516 L2106.5,506 L1737.5,506 A0,0 0 0 0 1737.5,506 " fill="#FBFB77" filter="url(#f1u4fyzgco69ug)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2106.5,506 L2106.5,516 L2116.5,516 L2106.5,506 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="358" x="1743.5" y="523.0669">dmlc(Distributed Machine Learning Common Codebase)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="1743.5" y="538.1997">&#x5206;&#x5E03;&#x5F0F;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x901A;&#x7528;&#x4EE3;&#x7801;&#x5E93;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="299" x="1743.5" y="553.3325">&#x63D0;&#x4F9B;&#x4E86;&#x6784;&#x5EFA;&#x9AD8;&#x6548;&#x4E14;&#x53EF;&#x6269;&#x5C55;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x673A;&#x5668;&#x5B66;&#x4E60;&#x5E93;&#x7684;&#x80FD;&#x529B;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="1743.5" y="568.4653">GraphRuntime &#x4F9D;&#x8D56;&#x4E8E; JSONReader</text><ellipse cx="1566.9433" cy="774.4887" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="215.4433" ry="45.4887" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="417" x="1358.4433" y="779.1371">&#x5229;&#x7528;JSONReader&#x5C06;graph.json&#x8F6C;&#x5316;&#x4E3A;&#x5185;&#x90E8;&#x6570;&#x636E;&#x7ED3;&#x6784;, &#x5B8C;&#x6210;load&#x8FC7;&#x7A0B;</text><ellipse cx="1157.7809" cy="774.5562" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="138.2809" ry="30.0562" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="258" x="1028.7809" y="779.2046">&#x5C06;graph&#x7684;attrs_.dltype&#x8F6C;&#x6362;&#x4E3A;TVMType</text><path d="M853.5,709 L853.5,840.0625 A0,0 0 0 0 853.5,840.0625 L984.5,840.0625 A0,0 0 0 0 984.5,840.0625 L984.5,778.5 L1019.3194,774.5 L984.5,770.5 L984.5,719 L974.5,709 L853.5,709 A0,0 0 0 0 853.5,709 " fill="#FBFB77" filter="url(#f1u4fyzgco69ug)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M974.5,709 L974.5,719 L984.5,719 L974.5,709 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="859.5" y="726.0669">&quot;attrs&quot;: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="875.5" y="741.1997">&quot;dltype&quot;: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="891.5" y="756.3325">&quot;list_str&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="891.5" y="771.4653">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="907.5" y="786.5981">&quot;float32&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="907.5" y="801.731">&quot;float32&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="891.5" y="816.8638">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="875.5" y="831.9966">],</text><ellipse cx="1142.8592" cy="1011.3718" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="84.8592" ry="19.3718" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="1071.8592" y="1016.0203">&#x6784;&#x5EFA;&#x6C60;&#x8282;&#x70B9;pool_entry</text><path d="M653,991.5 L653,1031.7656 A0,0 0 0 0 653,1031.7656 L1023,1031.7656 A0,0 0 0 0 1023,1031.7656 L1023,1015.5 L1057.875,1011.5 L1023,1007.5 L1023,1001.5 L1013,991.5 L653,991.5 A0,0 0 0 0 653,991.5 " fill="#FBFB77" filter="url(#f1u4fyzgco69ug)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1013,991.5 L1013,1001.5 L1023,1001.5 L1013,991.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="659" y="1008.5669">bytes = dltype[i] * shape[i]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="349" x="659" y="1023.6997">&#x4ECE;&#x6240;&#x6709;&#x8282;&#x70B9;&#x4E2D;&#x7ED9;&#x51FA;&#x6BCF;&#x4E2A;storage_id&#x5BF9;&#x5E94;&#x7684;&#x8282;&#x70B9;&#x7684;bytes&#x6700;&#x5927;&#x503C;</text><ellipse cx="1493.1913" cy="1011.3383" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="229.6913" ry="48.3383" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="446" x="1270.1913" y="1015.9867">&#x6BCF;&#x4E2A;storage_id&#x5BF9;&#x5E94;&#x7684;storage_pool_&#x4F7F;&#x7528;DeviceAPI AllocDataSpace</text><path d="M1758,968.5 L1758,1007.5 L1722.6602,1011.5 L1758,1015.5 L1758,1054.1641 A0,0 0 0 0 1758,1054.1641 L2136,1054.1641 A0,0 0 0 0 2136,1054.1641 L2136,978.5 L2126,968.5 L1758,968.5 A0,0 0 0 0 1758,968.5 " fill="#FBFB77" filter="url(#f1u4fyzgco69ug)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2126,968.5 L2126,978.5 L2136,978.5 L2126,968.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="1764" y="985.5669">&#x6240;&#x6709;&#x7684;target&#x7684;&#x5B9E;&#x73B0;&#x90FD;&#x7EE7;&#x627F;&#x4E8E;DeviceAPI&#x63A5;&#x53E3;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="1764" y="1000.6997">DeviceAPI &#x53D7; DeviceAPIManager &#x7BA1;&#x7406;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="1764" y="1015.8325">&#x901A;&#x8FC7; &quot;device_api.&quot; + target &#x7684;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x5177;&#x4F53; DeviceAPI</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="337" x="1764" y="1030.9653">&#x5177;&#x4F53; DeviceAPI &#x901A;&#x8FC7; TVM_REGISTER_GLOBAL &#x8FDB;&#x884C;&#x6CE8;&#x518C;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="347" x="1764" y="1046.0981">&#x5177;&#x4F53; DeviceAPI &#x5206;&#x5E03;&#x5728; src/runtime &#x4E3B;&#x76EE;&#x5F55;&#x53CA;&#x5404;&#x4E2A;&#x5B50;&#x76EE;&#x5F55;&#x4E0B;</text><ellipse cx="1435.1177" cy="1226.7235" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="206.6177" ry="43.7235" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="399" x="1235.6177" y="1231.372">&#x6839;&#x636E;storage_pool_ &#x6784;&#x5EFA; data_entry_, &#x5B8C;&#x6210;SetupStorage&#x8FC7;&#x7A0B;</text><ellipse cx="952.0367" cy="1226.5073" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="183.0367" ry="39.0073" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="198" x="853.0367" y="1209.2295">&#x904D;&#x5386;graph&#x4E2D;&#x6240;&#x6709;&#x975E;&#x2018;null&#x2019;&#x8282;&#x70B9;&#xFF0C;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="137" x="883.5367" y="1225.5264">&#x6784;&#x5EFA;DLTensor&#x5411;&#x91CF;&#xFF0C;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="307" x="798.5367" y="1241.8232">&#x5E76;&#x4E14;&#x83B7;&#x53D6;&#x6BCF;&#x4E00;&#x4E2A;node&#x7684;func&#x7EC4;&#x6210;op_execs_&#x5411;&#x91CF;</text><ellipse cx="842.169" cy="1407.5236" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="49.669" ry="14.5236" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="809.169" y="1412.1721">creat end</text><ellipse cx="1295.1985" cy="237.0236" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="32.6985" ry="14.5236" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="1274.1985" y="241.6721">Graph</text><path d="M894,43 L894,431.3203 A0,0 0 0 0 894,431.3203 L1228,431.3203 A0,0 0 0 0 1228,431.3203 L1228,241 L1262.4187,237 L1228,233 L1228,53 L1218,43 L894,43 A0,0 0 0 0 894,43 " fill="#FBFB77" filter="url(#f1u4fyzgco69ug)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1218,43 L1218,53 L1228,53 L1218,43 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="900" y="60.0669">a string of dict, similar to str({})</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="900" y="75.1997">&quot;{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="916" y="90.3325">&quot;nodes&quot;: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="932" y="105.4653">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="948" y="120.5981">&quot;op&quot;: &quot;null&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="948" y="135.731">&quot;name&quot;: &quot;x&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="948" y="150.8638">&quot;inputs&quot;: []</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="932" y="165.9966">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="932" y="181.1294">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="948" y="196.2622">&quot;op&quot;: &quot;tvm_op&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="948" y="211.395">&quot;name&quot;: &quot;relu0&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="948" y="226.5278">&quot;attrs&quot;: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="964" y="241.6606">&quot;flatten_data&quot;: &quot;0&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="964" y="256.7935">&quot;func_name&quot;: &quot;fuse_l2_normalize_relu&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="964" y="271.9263">&quot;num_inputs&quot;: &quot;1&quot;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="964" y="287.0591">&quot;num_outputs&quot;: &quot;1&quot;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="948" y="302.1919">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="948" y="317.3247">&quot;inputs&quot;:</text><a href="0," target="_top" actuate="onRequest" show="new" title="0," type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="24" x="1005" y="317.3247">0, 0</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1037" y="317.3247"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="932" y="332.4575">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="916" y="347.5903">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="916" y="362.7231">&quot;arg_nodes&quot;: [0],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="916" y="377.856">&quot;node_row_ptr&quot;: [0, 1, 2],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="916" y="392.9888">&quot;heads&quot;:</text><a href="1," target="_top" actuate="onRequest" show="new" title="1," type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="24" x="973" y="392.9888">0, 0</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="997" y="392.9888">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="916" y="408.1216">......</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="900" y="423.2544">}&quot;</text><ellipse cx="841.9282" cy="237.1426" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="16.9282" ry="14.1426" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="19" x="832.4282" y="241.791">Lib</text><path d="M576,224.5 L576,249.6328 A0,0 0 0 0 576,249.6328 L790,249.6328 A0,0 0 0 0 790,249.6328 L790,242.5 L824.983,237 L790,234.5 L790,234.5 L780,224.5 L576,224.5 A0,0 0 0 0 576,224.5 " fill="#FBFB77" filter="url(#f1u4fyzgco69ug)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M780,224.5 L780,234.5 L790,234.5 L780,224.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="582" y="241.5669">a Module object, contain lib.so</text><ellipse cx="502.0624" cy="237.0236" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="39.0624" ry="14.5236" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="51" x="476.5624" y="241.6721">params</text><path d="M22.5,171.5 L22.5,302.5625 A0,0 0 0 0 22.5,302.5625 L427.5,302.5625 A0,0 0 0 0 427.5,302.5625 L427.5,241 L462.7711,237 L427.5,233 L427.5,181.5 L417.5,171.5 L22.5,171.5 A0,0 0 0 0 22.5,171.5 " fill="#FBFB77" filter="url(#f1u4fyzgco69ug)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M417.5,171.5 L417.5,181.5 L427.5,181.5 L417.5,171.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="28.5" y="188.5669">a dict contains node params ...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="368" x="28.5" y="203.6997">{&apos;p22&apos;: &lt;tvm.NDArray shape=(8, 16, 3, 3, 8, 32), cpu(0)&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="319" x="44.5" y="218.8325">array([[[[[[-2.49230769e-02,  2.73413258e-03, ...,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="350" x="48.5" y="233.9653">7.61547452e-03, -6.19848166e-03, -2.52313819e-02],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="372" x="40.5" y="249.0981">[ 2.66786274e-02,  4.06193052e-04,  5.14294626e-03, ...,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="353" x="44.5" y="264.231">-3.45390639e-03,  4.50841105e-03,  5.40218735e-03],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="32.5" y="279.3638">......</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="28.5" y="294.4966">}</text><ellipse cx="1751.7739" cy="236.9192" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="17.2739" ry="14.4192" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="20" x="1741.7739" y="241.5676">ctx</text><path d="M1362.5,201.5 L1362.5,272.0313 A0,0 0 0 0 1362.5,272.0313 L1699.5,272.0313 A0,0 0 0 0 1699.5,272.0313 L1699.5,241 L1734.4545,237 L1699.5,233 L1699.5,211.5 L1689.5,201.5 L1362.5,201.5 A0,0 0 0 0 1362.5,201.5 " fill="#FBFB77" filter="url(#f1u4fyzgco69ug)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1689.5,201.5 L1689.5,211.5 L1699.5,211.5 L1689.5,201.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="1368.5" y="218.5669">a object class TVMContext or a list of TVMContext</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1368.5" y="233.6997">tvm.cpu(0)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="1368.5" y="248.8325">tvm.gpu(0)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="1368.5" y="263.9653">tvm.opencl(0)</text><ellipse cx="776.8237" cy="1518.8647" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="64.8237" ry="15.3647" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="730.3237" y="1523.5132">GraphModule</text><path d="M877.5,1499 L877.5,1515 L842.0781,1519 L877.5,1523 L877.5,1539.2656 A0,0 0 0 0 877.5,1539.2656 L1356.5,1539.2656 A0,0 0 0 0 1356.5,1539.2656 L1356.5,1509 L1346.5,1499 L877.5,1499 A0,0 0 0 0 877.5,1499 " fill="#FBFB77" filter="url(#f1u4fyzgco69ug)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1346.5,1499 L1346.5,1509 L1356.5,1509 L1346.5,1499 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="883.5" y="1516.0669">a wrapper of class GraphRuntime in c++</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="458" x="883.5" y="1531.1997">&#x672C;&#x8D28;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;Module&#x5B9E;&#x4F8B;&#xFF0C;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x4F5C;&#x4E3A;container&#x5305;&#x542B;&#x4E86;GraphRuntime&#x5B9E;&#x4F8B;</text><ellipse cx="1470.8678" cy="1519.1736" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="78.8678" ry="18.1736" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="1406.8678" y="1523.822">picture image data</text><ellipse cx="776.9738" cy="1635.3948" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="99.9738" ry="22.3948" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="176" x="688.9738" y="1640.0432">&#x8C03;&#x7528;set_input&#x5B8C;&#x6210;&#x53C2;&#x6570;&#x8F93;&#x5165;</text><path d="M912,1600 L912,1631.5 L877.0449,1635.5 L912,1639.5 L912,1670.5313 A0,0 0 0 0 912,1670.5313 L1366,1670.5313 A0,0 0 0 0 1366,1670.5313 L1366,1610 L1356,1600 L912,1600 A0,0 0 0 0 912,1600 " fill="#FBFB77" filter="url(#f1u4fyzgco69ug)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1356,1600 L1356,1610 L1366,1610 L1356,1600 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="433" x="918" y="1617.0669">call by PackedFunc GraphRuntime::GetFunction from python to c++</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="918" y="1632.1997">&#x5C06;&#x8F93;&#x5165;&#x6570;&#x636E;copy&#x5230;data_entry_&#x5BF9;&#x5E94;&#x7684;node&#x91CC;&#x9762;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="918" y="1647.3325">&#x5982;&#x679C;&#x8F93;&#x5165;&#x53C2;&#x6570;&#x662F;param&#xFF0C;&#x5FAA;&#x73AF;&#x662F;&#x5728;python&#x4FA7;&#x5B8C;&#x6210;&#x7684;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="918" y="1662.4653">c++ &#x63A5;&#x53E3;&#x6BCF;&#x6B21;&#x53EA;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;node&#x7684;&#x6570;&#x636E;</text><ellipse cx="777.0253" cy="1797.5051" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="75.5253" ry="17.5051" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="717.0253" y="1802.1535">GraphModule.run</text><path d="M888,1732 L888,1793.5 L852.5098,1797.5 L888,1801.5 L888,1863.0625 A0,0 0 0 0 888,1863.0625 L1192,1863.0625 A0,0 0 0 0 1192,1863.0625 L1192,1742 L1182,1732 L888,1732 A0,0 0 0 0 888,1732 " fill="#FBFB77" filter="url(#f1u4fyzgco69ug)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1182,1732 L1182,1742 L1192,1742 L1182,1732 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="894" y="1749.0669">so easy.............</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="898" y="1764.1997"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="894" y="1779.3325">void GraphRuntime::Run() {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="894" y="1794.4653">// setup the array and requirements.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="894" y="1809.5981">for (size_t i = 0; i &lt; op_execs_.size(); ++i) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="910" y="1824.731">if (op_execs_[i]) op_execs_[i]();</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="894" y="1839.8638">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="894" y="1854.9966">}</text><ellipse cx="777.1147" cy="1959.6229" fill="#FEFECE" filter="url(#f1u4fyzgco69ug)" rx="98.6147" ry="22.1229" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="690.6147" y="1964.2714">GraphModule.get_output</text><path d="M911,1924 L911,1955.5 L875.6563,1959.5 L911,1963.5 L911,1994.5313 A0,0 0 0 0 911,1994.5313 L1259,1994.5313 A0,0 0 0 0 1259,1994.5313 L1259,1934 L1249,1924 L911,1924 A0,0 0 0 0 911,1924 " fill="#FBFB77" filter="url(#f1u4fyzgco69ug)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1249,1924 L1249,1934 L1259,1934 L1249,1924 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="917" y="1941.0669">&#x4ECE;data_entry_&#x4E2D;&#x83B7;&#x53D6;&#x8F93;&#x51FA;&#x8282;&#x70B9;&#x6570;&#x636E;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="917" y="1956.1997">graph &#x4E2D;heads&#x5B57;&#x6BB5;&#x4FDD;&#x5B58;&#x4E86;&#x8F93;&#x51FA;note&#x4FE1;&#x606F;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="327" x="917" y="1971.3325">heads is a list of entries as the output of the graph.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="323" x="917" y="1986.4653">&#x5728;Init&#x9636;&#x6BB5;&#x4FBF;&#x89E3;&#x6790;&#x5230;&#x4E86;GraphRuntime&#x7684;outputs_&#x5B57;&#x6BB5;&#x4E2D;</text><!--link creat_step1 to creat_step2--><path d="M1406.7656,541.5 C1416.5675,541.5 1426.3694,541.5 1436.1713,541.5 " fill="none" id="creat_step1-creat_step2" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1441.297,541.5,1432.297,537.5,1436.297,541.5,1432.297,545.5,1441.297,541.5" style="stroke: #A80036; stroke-width: 1.0;"/><!--link creat_step2 to creat_step3--><path d="M1571.3869,570.0704 C1570.5667,608.2928 1569.0986,676.7056 1568.0882,723.7894 " fill="none" id="creat_step2-creat_step3" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1567.9796,728.8488,1572.1718,719.9367,1568.0869,723.85,1564.1736,719.765,1567.9796,728.8488" style="stroke: #A80036; stroke-width: 1.0;"/><!--link creat_step4 to creat_step3--><path d="M1301.7212,774.5 C1318.2336,774.5 1334.7459,774.5 1351.2583,774.5 " fill="none" id="creat_step4-creat_step3" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1296.5967,774.5,1305.5967,778.5,1301.5967,774.5,1305.5967,770.5,1296.5967,774.5" style="stroke: #A80036; stroke-width: 1.0;"/><!--link creat_step4 to creat_step5--><path d="M1156.1002,804.5162 C1153.1079,851.7945 1147.3525,942.7312 1144.5753,986.6101 " fill="none" id="creat_step4-creat_step5" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1144.2518,991.7218,1148.8124,982.9925,1144.5677,986.7318,1140.8283,982.4871,1144.2518,991.7218" style="stroke: #A80036; stroke-width: 1.0;"/><!--link creat_step5 to creat_step6--><path d="M1228.1074,1011.5 C1238.0937,1011.5 1248.08,1011.5 1258.0663,1011.5 " fill="none" id="creat_step5-creat_step6" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1263.2885,1011.5,1254.2885,1007.5,1258.2885,1011.5,1254.2885,1015.5,1263.2885,1011.5" style="stroke: #A80036; stroke-width: 1.0;"/><!--link creat_step6 to creat_step7--><path d="M1479.9113,1060.0183 C1470.4215,1095.196 1457.6394,1142.5782 1448.1381,1177.7983 " fill="none" id="creat_step6-creat_step7" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1446.7609,1182.9035,1452.967,1175.256,1448.0632,1178.0761,1445.2431,1173.1723,1446.7609,1182.9035" style="stroke: #A80036; stroke-width: 1.0;"/><!--link creat_step8 to creat_step7--><path d="M1140.1225,1226.5 C1169.57,1226.5 1199.0175,1226.5 1228.4651,1226.5 " fill="none" id="creat_step8-creat_step7" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1135.0117,1226.5,1144.0117,1230.5,1140.0117,1226.5,1144.0117,1222.5,1135.0117,1226.5" style="stroke: #A80036; stroke-width: 1.0;"/><!--link creat_step8 to ce--><path d="M928.4022,1265.329 C905.2722,1303.3885 870.999,1359.7834 853.3765,1388.7805 " fill="none" id="creat_step8-ce" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="850.6954,1393.1921,858.7879,1387.5786,853.2922,1388.9193,851.9514,1383.4237,850.6954,1393.1921" style="stroke: #A80036; stroke-width: 1.0;"/><!--link Graph to creat_step1--><path d="M1292.5921,251.5162 C1286.7743,285.1522 1270.5929,370.7626 1246,439 C1239.5263,456.9624 1230.8349,475.9367 1222.5152,492.6117 " fill="none" id="Graph-creat_step1" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="1220.1806,497.2512,1227.7991,491.0096,1222.428,492.7848,1220.6528,487.4137,1220.1806,497.2512" style="stroke: #A80036; stroke-width: 1.0;"/><!--link Lib to creat_step1--><path d="M839.9458,251.0371 C835.5118,287.0592 829.0068,383.8065 877,439 C878.7607,441.0248 984.5471,474.7922 1073.812,503.0237 " fill="none" id="Lib-creat_step1" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="1078.587,504.5335,1071.2117,498.0063,1073.8196,503.0261,1068.7998,505.6341,1078.587,504.5335" style="stroke: #A80036; stroke-width: 1.0;"/><!--link ctx to creat_step1--><path d="M1754.6422,251.3733 C1760.5738,288.6296 1770.5309,388.8982 1717,439 C1669.1967,483.7411 1488.1083,456.6942 1424,470 C1385.6128,477.9673 1344.4954,489.7965 1307.8951,501.5503 " fill="none" id="ctx-creat_step1" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="1302.9932,503.1326,1312.7868,504.1743,1307.7514,501.5966,1310.3292,496.5612,1302.9932,503.1326" style="stroke: #A80036; stroke-width: 1.0;"/><!--link ce to GraphModule--><path d="M833.5024,1422.0767 C822.0652,1441.6959 801.6676,1476.6856 788.7621,1498.8235 " fill="none" id="ce-GraphModule" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="786.1278,1503.3422,794.1162,1497.5815,788.646,1499.0226,787.2048,1493.5524,786.1278,1503.3422" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="816" y="1465.0669">return a object of GraphModule</text><!--link params to set_input--><path d="M505.6213,251.8642 C513.9455,285.5223 535.5385,370.002 559,439 C574.7954,485.4528 600,492.4352 600,541.5 C600,541.5 600,541.5 600,1519 C600,1571.0161 653.9953,1601.1123 702.3404,1617.6344 " fill="none" id="params-set_input" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="707.299,1619.2889,700.0279,1612.6458,702.5561,1617.7062,697.4956,1620.2344,707.299,1619.2889" style="stroke: #A80036; stroke-width: 1.0;"/><!--link input_data to set_input--><path d="M1413.9463,1531.5228 C1400.8575,1534.1842 1386.9751,1536.8394 1374,1539 C1162.3066,1574.2502 1104.918,1555.3781 895,1600 C876.1596,1604.0049 855.9758,1609.5838 837.724,1615.1342 " fill="none" id="input_data-set_input" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="832.6299,1616.6977,842.4074,1617.8807,837.4098,1615.2305,840.06,1610.2329,832.6299,1616.6977" style="stroke: #A80036; stroke-width: 1.0;"/><!--link GraphModule to set_input--><path d="M777,1534.7117 C777,1553.4199 777,1585 777,1607.8312 " fill="none" id="GraphModule-set_input" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="777,1612.8519,781,1603.8519,777,1607.8519,773,1603.8519,777,1612.8519" style="stroke: #A80036; stroke-width: 1.0;"/><!--link set_input to run--><path d="M777,1658.0254 C777,1688.7627 777,1743.5547 777,1774.5247 " fill="none" id="set_input-run" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="777,1779.6512,781,1770.6512,777,1774.6512,773,1770.6512,777,1779.6512" style="stroke: #A80036; stroke-width: 1.0;"/><!--link run to get_output--><path d="M777,1815.1452 C777,1843.3237 777,1898.6986 777,1932.0735 " fill="none" id="run-get_output" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="777,1937.2335,781,1928.2335,777,1932.2335,773,1928.2335,777,1937.2335" style="stroke: #A80036; stroke-width: 1.0;"/><!--
@startuml
rectangle greaph_runtime.creat {
    (根据python传入的ctx, 构建c++内部定义的TVMContext vector) as creat_step1
    note left
        从python/tvm/contrib/graph_runtime.py
        进入src/runtime/graph/graph_runtime.cc
    endnote

    (实例化第三方软件dmlc的JSONReader) as creat_step2
    note right
        dmlc(Distributed Machine Learning Common Codebase)
        分布式机器学习通用代码库,
        提供了构建高效且可扩展的分布式机器学习库的能力
        GraphRuntime 依赖于 JSONReader
    endnote

    (利用JSONReader将graph.json转化为内部数据结构, 完成load过程) as creat_step3

    (将graph的attrs_.dltype转换为TVMType) as creat_step4
    note left
        "attrs": {
            "dltype": [
                "list_str", 
                [
                    "float32", 
                    "float32",
                ]
            ],
    endnote

    (构建池节点pool_entry) as creat_step5
    note left
        bytes = dltype[i] * shape[i]
        从所有节点中给出每个storage_id对应的节点的bytes最大值
    endnote

    (每个storage_id对应的storage_pool_使用DeviceAPI AllocDataSpace) as creat_step6
    note right
        所有的target的实现都继承于DeviceAPI接口
        DeviceAPI 受 DeviceAPIManager 管理
        通过 "device_api." + target 的方式可以找到具体 DeviceAPI
        具体 DeviceAPI 通过 TVM_REGISTER_GLOBAL 进行注册
        具体 DeviceAPI 分布在 src/runtime 主目录及各个子目录下
    endnote

    (根据storage_pool_ 构建 data_entry_, 完成SetupStorage过程) as creat_step7

    (遍历graph中所有非‘null’节点，\n     构建DLTensor向量， \n     并且获取每一个node的func组成op_execs_向量) as creat_step8

    creat_step1 -right-> creat_step2
    creat_step2 -down-> creat_step3
    creat_step3 -left-> creat_step4
    creat_step4 -down-> creat_step5
    creat_step5 -right-> creat_step6
    creat_step6 -down-> creat_step7
    creat_step7 -left-> creat_step8

    (creat end) as ce
    creat_step8 - -> ce
}

rectangle "tvm build result"{
    (Graph)
    note left
        a string of dict, similar to str({})
        "{
            "nodes": [
                {
                    "op": "null",
                    "name": "x",
                    "inputs": []
                },
                {
                    "op": "tvm_op",
                    "name": "relu0",
                    "attrs": {
                        "flatten_data": "0",
                        "func_name": "fuse_l2_normalize_relu",
                        "num_inputs": "1",
                        "num_outputs": "1"
                    },
                    "inputs": [[0, 0, 0]]  
                }
            ],
            "arg_nodes": [0],
            "node_row_ptr": [0, 1, 2],
            "heads": [[1, 0, 0]],
            ......
        }"
    endnote
    (Graph) ..> creat_step1

    (Lib)
    note left
        a Module object, contain lib.so
    endnote
    (Lib) ..> creat_step1

    (params)
    note left
        a dict contains node params ...
        {'p22': <tvm.NDArray shape=(8, 16, 3, 3, 8, 32), cpu(0)>
            array([[[[[[-2.49230769e-02,  2.73413258e-03, ...,
             7.61547452e-03, -6.19848166e-03, -2.52313819e-02],
           [ 2.66786274e-02,  4.06193052e-04,  5.14294626e-03, ...,
            -3.45390639e-03,  4.50841105e-03,  5.40218735e-03],
         ......
        }
    endnote
}

(ctx)
note left
    a object class TVMContext or a list of TVMContext
    tvm.cpu(0)
    tvm.gpu(0)
    tvm.opencl(0)
endnote
(ctx) ..> creat_step1

(GraphModule)
note right
    a wrapper of class GraphRuntime in c++
    本质上是一个Module实例，这个实例作为container包含了GraphRuntime实例
endnote
ce - -> (GraphModule): return a object of GraphModule

(picture image data) as input_data

(调用set_input完成参数输入) as set_input
note right
    call by PackedFunc GraphRuntime::GetFunction from python to c++
    将输入数据copy到data_entry_对应的node里面
    如果输入参数是param，循环是在python侧完成的
    c++ 接口每次只接受一个node的数据
endnote
params ..> set_input
input_data ..> set_input
(GraphModule) - -> set_input


(GraphModule.run) as run
note right
    so easy.............

    void GraphRuntime::Run() {
    // setup the array and requirements.
    for (size_t i = 0; i < op_execs_.size(); ++i) {
        if (op_execs_[i]) op_execs_[i]();
    }
    }
endnote
set_input - -> run

(GraphModule.get_output) as get_output
note right
    从data_entry_中获取输出节点数据
    graph 中heads字段保存了输出note信息
    heads is a list of entries as the output of the graph.
    在Init阶段便解析到了GraphRuntime的outputs_字段中
endnote
run - -> get_output
@enduml

PlantUML version 1.2019.07(Tue Jun 25 03:59:20 CST 2019)
(MIT source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 12.0.1+12
Operating System: Linux
OS Version: 4.15.0-54-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg></p><h2 class="mume-header" id="code-flow">code-flow</h2>

<p>python/tvm/contrib/graph_runtime.py &#x4E2D;&#x5B9E;&#x73B0;&#x4E86;runtime creat&#x7684;python&#x63A5;&#x53E3;</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>graph_json_str<span class="token punctuation">,</span> libmod<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fcreate <span class="token operator">=</span> get_global_func<span class="token punctuation">(</span><span class="token string">&quot;tvm.graph_runtime.create&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> GraphModule<span class="token punctuation">(</span>fcreate<span class="token punctuation">(</span>graph_json_str<span class="token punctuation">,</span> libmod<span class="token punctuation">,</span> <span class="token operator">*</span>device_type_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><p>python/tvm/contrib/debugger/debug_runtime.py &#x4E2D;&#x5B9E;&#x73B0;&#x4E86;&#x6DB5;&#x76D6;debug&#x529F;&#x80FD;&#x7684;runtime creat python&#x63A5;&#x53E3;</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>graph_json_str<span class="token punctuation">,</span> libmod<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> dump_root<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    fcreate <span class="token operator">=</span> get_global_func<span class="token punctuation">(</span><span class="token string">&quot;tvm.graph_runtime_debug.create&quot;</span><span class="token punctuation">)</span>
    func_obj <span class="token operator">=</span> fcreate<span class="token punctuation">(</span>graph_json_str<span class="token punctuation">,</span> libmod<span class="token punctuation">,</span> <span class="token operator">*</span>device_type_id<span class="token punctuation">)</span>
    <span class="token keyword">return</span> GraphModuleDebug<span class="token punctuation">(</span>func_obj<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> graph_json_str<span class="token punctuation">,</span> dump_root<span class="token punctuation">)</span>
</pre><p>fcreate &#x8FD4;&#x56DE;&#x5305;&#x542B;c++&#x4EE3;&#x7801;&#x4E2D;creat&#x65B9;&#x6CD5;&#x7684;handle&#x7684;Function, &#x8C03;&#x7528;fcreate&#x5219;&#x9677;&#x5165;&#x5230;c++&#x4E2D;&#x6267;&#x884C;&#xFF0C; c++&#x7684;&#x4EE3;&#x7801;&#x4E3B;&#x8981;&#x96C6;&#x4E2D;&#x5728;<strong>src/runtime/graph/graph_runtime.cc&#x4E2D;</strong></p>
<h2 class="mume-header" id="module">Module</h2>

<p><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" contentscripttype="application/ecmascript" contentstyletype="text/css" height="414px" preserveAspectRatio="none" style="width:825px;height:414px;" version="1.1" viewBox="0 0 825 414" width="825px" zoomAndPan="magnify"><defs><filter height="300%" id="f19fphduiqhwu9" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="698.614" cy="264.8228" fill="#FEFECE" filter="url(#f19fphduiqhwu9)" rx="114.614" ry="25.3228" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="655.114" y="257.062">host module</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="188" x="604.614" y="273.3589">class tvm::runtime::Module</text><ellipse cx="698.7153" cy="130.5431" fill="#FEFECE" filter="url(#f19fphduiqhwu9)" rx="115.7153" ry="25.5431" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="648.2153" y="123.186">device module</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="188" x="604.7153" y="139.4829">class tvm::runtime::Module</text><ellipse cx="154.3278" cy="265.0656" fill="#FEFECE" filter="url(#f19fphduiqhwu9)" rx="148.3278" ry="32.0656" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="132.8278" y="253.4171">param</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="279" x="14.8278" y="269.714">&#x4EE5;graph&#x4E2D;&#x7684;node&#x7684;name&#x4E3A;key&#x7684;&#x53C2;&#x6570;&#x5B57;&#x5178;</text><ellipse cx="443.6042" cy="265.0208" fill="#FEFECE" filter="url(#f19fphduiqhwu9)" rx="105.6042" ry="23.5208" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="423.6042" y="257.6905">graph</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="163" x="362.1042" y="273.9874">&#x5305;&#x542B;&#x6240;&#x6709;node&#x7684;json&#x8868;&#x8FBE;</text><!--entity device.so--><rect fill="#FEFECE" filter="url(#f19fphduiqhwu9)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="655.5" y="8"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="650.5" y="13"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="650.5" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="665.5" y="30.9951">device.so</text><ellipse cx="443.4472" cy="388.5236" fill="#FEFECE" filter="url(#f19fphduiqhwu9)" rx="57.4472" ry="14.5236" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77" x="404.9472" y="393.1721">runtime Init</text><!--link device.so to dm--><path d="M698.5,44.2025 C698.5,59.3589 698.5,81.2851 698.5,99.2431 " fill="none" id="device.so-dm" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="698.5,104.6769,702.5,95.6769,698.5,99.6769,694.5,95.6769,698.5,104.6769" style="stroke: #A80036; stroke-width: 1.0;"/><!--link hm to runtime Init--><path d="M650.5365,288.2294 C599.0325,313.1735 518.6984,352.0804 474.7769,373.3522 " fill="none" id="hm-runtime Init" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="470.1239,375.6057,479.9675,375.2825,474.6239,373.4262,476.4802,368.0826,470.1239,375.6057" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="563.5" y="340.0669">input</text><!--link dm to hm--><path d="M698.5,161.3272 C698.5,184.9867 698.5,217.2592 698.5,239.4804 " fill="none" id="dm-hm" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="698.5,156.115,694.5,165.115,698.5,161.115,702.5,165.115,698.5,156.115" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="699.5" y="199.0669">call</text><!--link param to runtime Init--><path d="M221.5288,293.6438 C280.37,318.7887 363.5439,354.3319 409.5583,373.9955 " fill="none" id="param-runtime Init" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="414.1652,375.9642,407.4611,368.7493,409.5674,373.9994,404.3174,376.1057,414.1652,375.9642" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="333.5" y="340.0669">input</text><!--link graph to runtime Init--><path d="M443.5,288.5201 C443.5,311.7464 443.5,346.8695 443.5,368.7078 " fill="none" id="graph-runtime Init" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="443.5,373.9584,447.5,364.9584,443.5,368.9584,439.5,364.9584,443.5,373.9584" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="444.5" y="340.0669">input</text><!--
@startuml
(host module\nclass tvm::runtime::Module) as hm
(device module\nclass tvm::runtime::Module) as dm

(param \n以graph中的node的name为key的参数字典) as param

(graph \n包含所有node的json表达) as graph

[device.so] - -> dm

hm - -> (runtime Init): input
dm <- - hm : call
(param) - -> (runtime Init): input
(graph) - -> (runtime Init): input
@enduml

PlantUML version 1.2019.07(Tue Jun 25 03:59:20 CST 2019)
(MIT source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 12.0.1+12
Operating System: Linux
OS Version: 4.15.0-54-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg></p><p>&#x5BF9;&#x4E8E;runtime&#x8F93;&#x5165;Module&#x6765;&#x8BB2;&#xFF0C;&#x5B83;&#x6709;&#x5F88;&#x591A;&#x5B50;&#x7C7B;&#xFF0C;&#x5BF9;&#x5E94;&#x6BCF;&#x4E00;&#x79CD;target,&#x9664;&#x6B64;&#x4E4B;&#x5916;RelayBuildModule&#x548C;GraphRuntimeCodeGenModule&#x4E5F;&#x662F;module&#x5B50;&#x7C7B;&#xFF0C;&#x5176;&#x4E2D;RelayBuildModule&#x662F;&#x5728;relay&#x524D;&#x7AEF;&#x4E4B;&#x540E;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x5B9E;&#x73B0;&#x5728;<strong>relay.build_module._BuildModule</strong>&#x4E2D;,&#x8D1F;&#x8D23;&#x8FDB;&#x884C;relay&#x5C42;build&#x3002;<mark>GraphRuntimeCodeGenModule&#x8FD9;&#x4E2A;&#x5B50;&#x7C7B;&#x7684;&#x4F5C;&#x7528;&#x540E;&#x7EED;&#x8865;&#x5145;</mark></p>
<h2 class="mume-header" id="graph">graph</h2>

<p>&#x5B98;&#x65B9;&#x6587;&#x6863;&#x6709;&#x6BD4;&#x8F83;&#x660E;&#x786E;&#x7684;&#x4ECB;&#x7ECD;&#xFF0C;&#x5176;&#x4E2D;attr&#x4E2D;&#x7684;storage_id&#x662F;&#x5728;&#x7F16;&#x8BD1;&#x65F6;&#x521B;&#x5EFA;&#x7684;&#x5B58;&#x50A8;ID&#xFF0C;&#x4E00;&#x4E2A;storage_id&#x5BF9;&#x5E94;&#x4E00;&#x5757;&#x5185;&#x5B58;&#xFF0C;storage_id&#x4E0E;Tensor&#x662F;&#x4E00;&#x5BF9;&#x591A;&#x7684;&#x5173;&#x7CFB;&#x3002;</p>
<h2 class="mume-header" id="param">param</h2>

<p>a dict</p>
<h2 class="mume-header" id="deviceapi">deviceAPI</h2>

<p>deviceAPI&#x662F;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x6BCF;&#x79CD;target&#x90FD;&#x5BF9;&#x5E94;&#x5B9E;&#x73B0;&#x4E86;&#x8BE5;&#x63A5;&#x53E3;&#xFF0C;deviceAPI &#x66F4;&#x591A;&#x7684;&#x662F;&#x9488;&#x5BF9;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#xFF0C;&#x90E8;&#x5206;API&#x5C01;&#x88C5;&#x5728;<strong>c_runtime_api.cc</strong>&#x4E2D;&#x4F9B;&#x4E0A;&#x5C42;&#x8C03;&#x7528;&#xFF0C;&#x5728;python&#x7AEF;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;_LIB.xxxx&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x8C03;&#x7528;</p>
<ul>
<li>CPUDeviceAPI</li>
<li>CUDADeviceAPI</li>
<li>OpenCLWorkspace</li>
<li>OpenGLWorkspace</li>
<li>ROCMDeviceAPI</li>
<li>RPCDeviceAPI</li>
<li>VTADeviceAPI</li>
</ul>
<pre data-role="codeBlock" data-info="c++" class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">TVM_DLL</span> DeviceAPI <span class="token punctuation">{</span>
 <span class="token keyword">public</span><span class="token operator">:</span>
  <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">DeviceAPI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SetDevice</span><span class="token punctuation">(</span>TVMContext ctx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">GetAttr</span><span class="token punctuation">(</span>TVMContext ctx<span class="token punctuation">,</span> DeviceAttrKind kind<span class="token punctuation">,</span> TVMRetValue<span class="token operator">*</span> rv<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">virtual</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">AllocDataSpace</span><span class="token punctuation">(</span>TVMContext ctx<span class="token punctuation">,</span>
                               size_t nbytes<span class="token punctuation">,</span>
                               size_t alignment<span class="token punctuation">,</span>
                               TVMType type_hint<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">FreeDataSpace</span><span class="token punctuation">(</span>TVMContext ctx<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> ptr<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">CopyDataFromTo</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span> from<span class="token punctuation">,</span>
                              size_t from_offset<span class="token punctuation">,</span>
                              <span class="token keyword">void</span><span class="token operator">*</span> to<span class="token punctuation">,</span>
                              size_t to_offset<span class="token punctuation">,</span>
                              size_t num_bytes<span class="token punctuation">,</span>
                              TVMContext ctx_from<span class="token punctuation">,</span>
                              TVMContext ctx_to<span class="token punctuation">,</span>
                              TVMType type_hint<span class="token punctuation">,</span>
                              TVMStreamHandle stream<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">virtual</span> TVMStreamHandle <span class="token function">CreateStream</span><span class="token punctuation">(</span>TVMContext ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">FreeStream</span><span class="token punctuation">(</span>TVMContext ctx<span class="token punctuation">,</span> TVMStreamHandle stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">StreamSync</span><span class="token punctuation">(</span>TVMContext ctx<span class="token punctuation">,</span> TVMStreamHandle stream<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SetStream</span><span class="token punctuation">(</span>TVMContext ctx<span class="token punctuation">,</span> TVMStreamHandle stream<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">SyncStreamFromTo</span><span class="token punctuation">(</span>TVMContext ctx<span class="token punctuation">,</span>
                                        TVMStreamHandle event_src<span class="token punctuation">,</span>
                                        TVMStreamHandle event_dst<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">virtual</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">AllocWorkspace</span><span class="token punctuation">(</span>TVMContext ctx<span class="token punctuation">,</span>
                                       size_t nbytes<span class="token punctuation">,</span>
                                       TVMType type_hint <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">FreeWorkspace</span><span class="token punctuation">(</span>TVMContext ctx<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> DeviceAPI<span class="token operator">*</span> <span class="token function">Get</span><span class="token punctuation">(</span>TVMContext ctx<span class="token punctuation">,</span> <span class="token keyword">bool</span> allow_missing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="setdevice">SetDevice</h3>

<p>&#x4E3B;&#x8981;&#x662F;&#x5904;&#x7406;device id&#xFF0C; &#x5BF9;&#x4E8E;cuda&#x6765;&#x8BB2;&#xFF0C;&#x5E94;&#x8BE5;&#x5C31;&#x662F;&#x7B2C;&#x51E0;&#x4E2A;&#x677F;&#x5361;&#xFF1B;&#x5BF9;&#x4E8E;cpu&#xFF0C;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x5E76;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x5728;&#x6574;&#x4E2A;runtime&#x8FC7;&#x7A0B;&#x4E2D;&#x6CA1;&#x6709;&#x5730;&#x65B9;&#x8FDB;&#x884C;&#x4E3B;&#x52A8;&#x8C03;&#x7528;&#xFF0C;&#x5728;cuda&#x7684;&#x5B9E;&#x73B0;&#x4E2D;&#xFF0C;&#x5BF9;&#x4E8E;deviceAPI&#x7684;&#x6BCF;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x91CC;&#x9762;&#x90FD;&#x4F1A;&#x8C03;&#x7528;&#x81EA;&#x5DF1;&#x7684;cudaSetDevice&#x63A5;&#x53E3;&#x3002;</p>
<h3 class="mume-header" id="getattr">GetAttr</h3>

<p>&#x6839;&#x636E;&#x4F20;&#x5165;&#x7684;&#x4E0D;&#x540C;&#x7684;DeviceAttrKind&#xFF0C;&#x8FD4;&#x56DE;&#x4E0D;&#x540C;&#x7684;&#x8BBE;&#x5907;&#x5C5E;&#x6027;&#xFF0C;cuda&#x6BCF;&#x4E00;&#x4E2A;&#x5E93;&#x51FD;&#x6570;&#x90FD;&#x8981;&#x6C42;&#x4F20;&#x5165;device_id&#xFF0C;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x5728;&#x8BBE;&#x8BA1;&#x65F6;&#x611F;&#x89C9;&#x50CF;&#x57FA;&#x4E8E;cuda&#x5E93;&#x8FDB;&#x884C;&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x547D;&#x540D;&#x4E0A;&#x8DDF;cuda&#x5F88;&#x50CF;&#x3002;</p>
<p>&#x5728;python class TVMContext(python/tvm/_ffi/runtime_ctypes.py)&#x4E2D;&#x5C01;&#x88C5;&#x4E86;GetAttr&#x7684;&#x4E0A;&#x5C42;&#x8C03;&#x7528;,&#x5728;&#x56FE;&#x7F16;&#x8BD1;&#x548C;&#x6267;&#x884C;&#x7684;&#x6D41;&#x7A0B;&#x4E2D;&#x4E0D;&#x4F1A;&#x88AB;&#x8C03;&#x7528;</p>
<h3 class="mume-header" id="allocdataspace">AllocDataSpace</h3>

<p>&#x5728;device&#x4E0A;&#x7533;&#x8BF7;&#x5185;&#x5B58;&#x7A7A;&#x95F4;</p>
<p>&#x5728;runtime Init&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x8C03;&#x7528;&#x8BE5;&#x63A5;&#x53E3;&#xFF0C;&#x5728;devie&#x4E0A;&#x4E3A;tensor&#x5206;&#x914D;&#x7A7A;&#x95F4;</p>
<h3 class="mume-header" id="freedataspace">FreeDataSpace</h3>

<p>&#x5728;c++ &#x7C7B;class NDArray &#x7684;&#x6790;&#x6784;&#x51FD;&#x6570;&#x91CC;&#x9762;&#x4F1A;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#xFF0C; NDArray&#x91CC;&#x9762;&#x5305;&#x542B;&#x4E86;DLTensor</p>
<h3 class="mume-header" id="copydatafromto">CopyDataFromTo</h3>

<p>&#x5B9E;&#x73B0;&#x4E86;&#x6570;&#x636E;copy&#xFF0C;&#x652F;&#x6301;host&#x4E4B;&#x95F4;&#xFF0C;device&#x4E4B;&#x95F4;&#x548C;host-device&#x76F4;&#x63A5;&#x7684;&#x6570;&#x636E;copy</p>
<h3 class="mume-header" id="createstream">CreateStream</h3>

<p>&#x53EA;&#x6709;cuda&#x652F;&#x6301;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x4E5F;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x5728;&#x4EC0;&#x4E48;&#x5730;&#x65B9;&#x6709;&#x8C03;&#x7528;</p>
<h3 class="mume-header" id="allocworkspace">AllocWorkspace</h3>

<p>&#x5206;&#x914D;&#x5DE5;&#x4F5C;&#x7A7A;&#x95F4;&#xFF0C;&#x5185;&#x90E8;&#x5B9E;&#x9645;&#x4E0A;&#x8FD8;&#x662F;&#x8C03;&#x7528;AllocDataSpace</p>
<p>&#x4EC0;&#x4E48;&#x60C5;&#x51B5;&#x4E0B;&#x4F7F;&#x7528;&#xFF1F;</p>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>